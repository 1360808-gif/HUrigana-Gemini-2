<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ふりがなメーカー (軽量版)</title>
    <script src="https://unpkg.com/wanakana"></script>
    <style>
        body { font-family: sans-serif; max-width: 600px; margin: 20px auto; padding: 20px; background: #f4f4f9; }
        .card { background: white; padding: 20px; border-radius: 10px; shadow: 0 2px 5px rgba(0,0,0,0.1); }
        textarea { width: 100%; height: 100px; margin-bottom: 20px; border: 1px solid #ccc; border-radius: 5px; padding: 10px; font-size: 16px; }
        #output { font-size: 24px; line-height: 2.5; background: #fff; min-height: 100px; }
        rt { color: #ff5e57; font-size: 0.6em; }
    </style>
</head>
<body>

<div class="card">
    <h2>ふりがなメーカー</h2>
    <textarea id="input" placeholder="ここに貼り付けてください..."></textarea>
    <div id="output"></div>
</div>

<script>
    const input = document.getElementById('input');
    const output = document.getElementById('output');

    // ブラウザ標準の解析機能（Intl.Segmenter）が使えるか確認
    if (!window.Intl || !window.Intl.Segmenter) {
        output.innerHTML = "お使いのブラウザが古いため動作しません。最新のChrome等でお試しください。";
    }

    const segmenter = new Intl.Segmenter('ja-JP', { granularity: 'word' });

    input.addEventListener('input', () => {
        const text = input.value;
        if (!text) { output.innerHTML = ""; return; }

        const segments = segmenter.segment(text);
        let resultHtml = "";

        for (const segment of segments) {
            const word = segment.segment;
            
            // 漢字が含まれているかチェック
            if (/[\u4E00-\u9FFF]/.test(word)) {
                // 読みを推測（※簡易的な推測になるため、複雑な語彙はGitHub Pages上での確認を推奨）
                // ここでは「読み」を取得するためにGoogleのAPIを補助的に使うか、
                // もしくは入力された漢字をそのままルビ構造にします。
                resultHtml += `<ruby>${word}<rt>（読み）</rt></ruby>`;
            } else {
                resultHtml += word;
            }
        }
        
        // 注：ブラウザ標準機能だけでは「正確な読み」の取得に限界があるため
        // 最も確実な「Yahoo!かな振替API」等を使わない簡易版として表示します。
        // 正確な読みが必要な場合は、下記の「修正版」を試してください。
        updateFurigana(text);
    });

    async function updateFurigana(text) {
        // Google翻訳の仕組みを応用した、より軽量な取得方法
        const url = `https://translate.googleapis.com/translate_a/single?client=gtx&sl=ja&tl=ja&dt=rm&q=${encodeURIComponent(text)}`;
        
        try {
            const response = await fetch(url);
            const data = await response.json();
            // data[1] にローマ字読みが入るので、それをひらがなに戻す処理
            const romaji = data[0][1] ? data[0][1][3] : "";
            if (romaji) {
                const hiragana = wanakana.toHiragana(romaji);
                output.innerHTML = `<ruby>${text}<rt>${hiragana}</rt></ruby>`;
            }
        } catch (e) {
            output.innerHTML = "読み込み中、またはエラーです。";
        }
    }
</script>

</body>
</html>
