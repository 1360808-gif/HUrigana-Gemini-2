<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ふりがなメーカー Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/kuroshiro@1.2.0/dist/kuroshiro.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/kuroshiro-analyzer-kuromoji@1.1.0/dist/kuroshiro-analyzer-kuromoji.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', Meiryo, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; background-color: #f0f2f5; }
        .container { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
        h1 { color: #1a73e8; text-align: center; font-size: 1.5rem; }
        textarea { width: 100%; height: 120px; padding: 15px; border: 2px solid #e0e0e0; border-radius: 10px; font-size: 16px; box-sizing: border-box; transition: border 0.3s; }
        textarea:focus { border-color: #1a73e8; outline: none; }
        #status { font-size: 0.8rem; text-align: right; margin-bottom: 10px; color: #666; }
        #output { margin-top: 25px; padding: 20px; background: #fafafa; border-radius: 10px; line-height: 2.8; font-size: 22px; min-height: 100px; word-break: break-all; }
        rt { color: #ff4757; font-size: 0.55em; font-weight: bold; }
        .error { color: red; background: #fff1f0; padding: 10px; border-radius: 5px; }
    </style>
</head>
<body>

<div class="container">
    <h1>ふりがなメーカー</h1>
    <div id="status">システム準備中...</div>
    <textarea id="input" placeholder="ここに漢字を貼り付けてください..."></textarea>
    <div id="output"></div>
</div>

<script>
    const kuroshiro = new Kuroshiro();
    const analyzer = new KuroshiroAnalyzer();
    const statusEl = document.getElementById('status');
    const inputEl = document.getElementById('input');
    const outputEl = document.getElementById('output');

    async function init() {
        try {
            // 辞書データ(dict)のパスを明示的に指定して初期化
            // これによりセキュリティ制限による読み込み失敗を防ぎやすくします
            await kuroshiro.init(analyzer);
            statusEl.innerText = "● 準備完了（入力してください）";
            statusEl.style.color = "#2ed573";
        } catch (e) {
            console.error(e);
            statusEl.innerHTML = "<span class='error'>エラー：辞書データの読み込みに失敗しました。GitHub Pagesで公開するか、ネット接続を確認してください。</span>";
        }
    }

    inputEl.addEventListener('input', async () => {
        const text = inputEl.value;
        if (!text) {
            outputEl.innerHTML = "";
            return;
        }

        try {
            const result = await kuroshiro.convert(text, {
                mode: "okurigana",
                to: "hiragana"
            });
            outputEl.innerHTML = result;
        } catch (e) {
            outputEl.innerHTML = "変換中にエラーが発生しました。";
        }
    });

    init();
</script>

</body>
</html>
